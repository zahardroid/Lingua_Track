{% extends 'base.html' %}

{% block title %}Тест - LinguaTrack{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h2><i class="bi bi-question-circle"></i> Тест</h2>
                {% if not single and remaining > 0 %}
                    <small>Осталось карточек: {{ remaining }}</small>
                {% endif %}
            </div>
            <div class="card-body text-center">
                <h1 class="display-4 mb-4">{{ card.word }}</h1>
                
                <div id="answer-section" style="display: none;">
                    <h3 class="text-primary mb-3">{{ card.translation }}</h3>
                    {% if card.example %}
                        <p class="text-muted mb-4">{{ card.example }}</p>
                    {% endif %}
                </div>

                <div id="quality-buttons" style="display: none;" class="mt-4">
                    <p class="mb-3">Насколько хорошо вы знали это слово?</p>
                    <form method="post" action="{% url 'cards:submit_answer' card.pk %}">
                        {% csrf_token %}
                        <div class="row g-2">
                            <div class="col-6 col-md-3">
                                <button type="submit" name="quality" value="0" class="btn btn-danger w-100">
                                    <i class="bi bi-x-circle"></i><br>0 - Не знал
                                </button>
                            </div>
                            <div class="col-6 col-md-3">
                                <button type="submit" name="quality" value="1" class="btn btn-warning w-100">
                                    <i class="bi bi-exclamation-circle"></i><br>1 - С трудом
                                </button>
                            </div>
                            <div class="col-6 col-md-3">
                                <button type="submit" name="quality" value="3" class="btn btn-info w-100">
                                    <i class="bi bi-question-circle"></i><br>3 - Нормально
                                </button>
                            </div>
                            <div class="col-6 col-md-3">
                                <button type="submit" name="quality" value="5" class="btn btn-success w-100">
                                    <i class="bi bi-check-circle"></i><br>5 - Легко
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <div id="show-answer-section" class="mt-4">
                    <button class="btn btn-primary btn-lg" onclick="showAnswer()">
                        <i class="bi bi-eye"></i> Показать ответ
                    </button>
                    <button class="btn btn-outline-secondary btn-lg ms-2" onclick="playAudio('{{ card.word }}')">
                        <i class="bi bi-volume-up"></i> Озвучить
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function showAnswer() {
    document.getElementById('answer-section').style.display = 'block';
    document.getElementById('quality-buttons').style.display = 'block';
    document.getElementById('show-answer-section').style.display = 'none';
}

function playAudio(word) {
    const audioUrl = `/cards/say/${encodeURIComponent(word)}/`;
    const audio = new Audio(audioUrl);
    audio.play().catch(err => {
        console.error('Ошибка воспроизведения:', err);
    });
}
</script>
{% endblock %}

